<!DOCTYPE html>
<html>

<head>
  
  <title>BLEoE(1) | VikingWarlock</title>
  <meta name="google-site-verification" content="" />
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta itemprop="name" content="VikingWarlock" />
  <meta itemprop="description" content="VKWK's blog" />
  <meta itemprop="image" content="" />
  <link rel="shortcut icon" href="" type="image/x-icon">
  <!-- keywords and description -->
  
  <meta name="keywords" content="" />
  <meta name="description" content="Long distance bluetooth" />
  
  
<link rel="stylesheet" href="/hexosource/css/style.css">

  <script src="//cdn.jsdelivr.net/npm/@waline/client/dist/Waline.min.js"></script>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css" integrity="sha384-KiWOvVjnN8qwAZbuQyWDIbfCLFhLXNETzBQjA/92pIowpC0d2O3nppDGQVgwd2nB" crossorigin="anonymous">
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js" integrity="sha384-0fdwu/T/EQMsQlrHCCHoH10pkPLlKA1jL5dFyUOvB3lfeT2540/2g6YgSi2BL14p" crossorigin="anonymous"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/contrib/auto-render.min.js" integrity="sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR" crossorigin="anonymous"
      onload="renderMathInElement(document.body);"></script>
<meta name="generator" content="Hexo 5.3.0"></head>


<body>
  <div id="container">
    <header>
  <div class="site-title">
    <a href="/">
      VikingWarlock
    </a>
  </div>
  
  <div class="site-subtitle">
    VKWK's blog
  </div>
  
  
  <p class="links">
    
    <a href="">
      <img src="/images/links/" alt="">
    </a>
    
  </p>
  
</header>
    <div id="main">
      <article class="post">
  <h3 class="date">
  <time datetime="2018-08-25T17:38:38.000Z">
    Aug 26, 2018
  </time>
</h3>
  <h1>BLEoE(1)</h1>
  <p class="post-info">
  
  <span class="post-info-item author">VikingWarlock</span>
  
  
  <a href="/hexosource/programming/20180826-BLEoE-1.html#waline" class="post-info-item comment-count waline-comment-count" id="/hexosource/programming/20180826-BLEoE-1.html">获取中...</a>
  <span class="post-info-item view-count waline-visitor-count" id="/hexosource/programming/20180826-BLEoE-1.html">获取中...</span>
  
</p>
  
<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/hexosource/tags/play/" rel="tag">玩玩的</a></li></ul>

  
  <article>
    <h3 id="Context"><a href="#Context" class="headerlink" title="Context"></a>Context</h3><p>蓝牙的传输距离实在是不够长，对于我这种调试人员来说，如果可以有一种方法，远程的调试蓝牙外设，那岂不是超级爽歪歪嘛？</p>
<p>所以某一天洗澡的时候，我就打算使用网络来传输蓝牙数据～</p>
<p>借鉴OSI分层或者网络分层的结构，我觉得只要对BLE传输的数据做一层封装，再通过tcp来传输就可以解决这个问题。</p>
<h3 id="Let’s-do-it"><a href="#Let’s-do-it" class="headerlink" title="Let’s do it"></a>Let’s do it</h3><p>所以这个系统需要至少三个东西，一台作为central的硬件，一台作为peripheral的硬件，以及一个将他们连在一起的服务器。</p>
<p>由于我手上恰恰恰恰好有两台Linkit One物联网开发平台，而且它本身就拥有蓝牙，Wi-Fi的功能，所以central和peripheral肯定就用这两个硬件来试验了～</p>
<p>服务器的话，测试阶段也可以很简单，只要简简单单的将两方的数据做一个交换就好了。再这个阶段并不需要安全认证，多用户绑定，数据正确性检查，数据缓存等等功能，<br>只要交换就好！</p>
<p>因为python写的贼熟悉了，所以当然还是搞一个简单的python socket服务器比较好。</p>
<p>这个项目开个源吧</p>
<p>Coding.Net : <a href="https://git.coding.net/vikingwarlock/BLEoE.git" target="_blank" rel="noopener">https://git.coding.net/vikingwarlock/BLEoE.git</a></p>
<p>Github: <a href="https://github.com/VikingWarlock/BLEoE.git" target="_blank" rel="noopener">https://github.com/VikingWarlock/BLEoE.git</a></p>
<p>两个进度会不一样，因为github上面还是不要留太多的草稿吧</p>
<h4 id="TCP-or-UDP"><a href="#TCP-or-UDP" class="headerlink" title="TCP or UDP"></a>TCP or UDP</h4><p>嗯，这个问题可能会比较有争议。一开始我是打算使用udp的，因为会比较快，我担心未来网络延迟或者服务器性能不佳会导致数据包在网络上耽误较长的时间，导致蓝牙操作超时。<br>可是udp很不可靠，万一出事情了，反而得不偿失。所以先使用tcp来测试测试。</p>
<p>先贴一下我简简单单搞得2用户数据交换的tcp服务器代码吧</p>
<pre><code>import asyncore
import socket

handler_list = {}


class EchoHandler(asyncore.dispatcher_with_send):

    def configure_local_address(self, address):
        self.address = address

    def configure_target_address(self, address):
        self.target_address = address

    def handle_read(self):
        data = self.recv(8192)
        if data and self.target_address:
            hd = handler_list.get(self.target_address)
            if hd:
                hd.send(data)
            else:
                self.target_address = None
                self.send(&quot;fail to send, target is down&quot;)
        else:
            self.send(&quot;no target&quot;)

    def handle_close(self):
        handler_list[self.address] = None
        self.close()
        print &apos;connection from %s lost&apos; % repr(self.addr)


class EchoServer(asyncore.dispatcher):

    def __init__(self, host, port):
        asyncore.dispatcher.__init__(self)
        self.create_socket(socket.AF_INET, socket.SOCK_STREAM)
        self.set_reuse_addr()
        self.bind((host, port))
        self.listen(5)

    def handle_accept(self):
        pair = self.accept()
        if pair is not None:
            sock, addr = pair
            print &apos;Incoming connection from %s&apos; % repr(addr)
            handler = EchoHandler(sock)
            handler.configure_local_address(addr)
            handler_list[addr] = handler
            if len(handler_list) &gt; 1:
                it1 = handler_list.values()[0]
                it2 = handler_list.values()[1]
                it1.configure_target_address(it2.address)
                it2.configure_target_address(it1.address)

    def handle_close(self):
        self.close()


server = EchoServer(&apos;0.0.0.0&apos;, 3344)
asyncore.loop()
</code></pre>
  </article>
  
  <hr>
  <blockquote>
    <p>
      本文由 <a href="">VikingWarlock</a> 创作，采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by/4.0/">知识共享署名 4.0</a> 国际许可协议。
    </p>
    <p>
      本站文章除注明转载/出处外，均为本站原创或翻译，转载请务必署名。
    </p>
  </blockquote>
  
</article>


<div id="waline"></div>

    </div>
  </div>
  <footer>
  
  
  <p id="busuanzi_container_site_pv">
    本站访问量 <span id="busuanzi_value_site_pv">获取中...</span>
  </p>
  
  <p>
    Powered by <a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a> | Theme <a target="_blank" rel="noopener" href="https://github.com/syy11cn/hexo-theme-linear">Linear</a> from <a target="_blank" rel="noopener" href="https://syy11.cn">Yiyang Sun</a>
  </p>
</footer>
  
  <script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js">
  </script>
  <script>
    Waline({
      el: '#waline',
      placeholder: '',
      avatar: 'retro',
      visitor: true,
      requiredFields: ['nick', 'mail'],
      serverURL: '',
      emoji: [
        'https://cdn.jsdelivr.net/gh/walinejs/emojis@1.0.0/bilibili',
        'https://cdn.jsdelivr.net/gh/walinejs/emojis@1.0.0/qq',
        'https://cdn.jsdelivr.net/gh/walinejs/emojis@1.0.0/alus',
        'https://cdn.jsdelivr.net/gh/walinejs/emojis@1.0.0/tw-emoji',
        'https://cdn.jsdelivr.net/gh/walinejs/emojis@1.0.0/weibo',
        'https://cdn.jsdelivr.net/gh/walinejs/emojis@1.0.0/tieba',
      ]
    });
  </script>
</body>

</html>