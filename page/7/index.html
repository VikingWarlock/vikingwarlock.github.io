<!DOCTYPE HTML>
<html>
<head >
  <meta charset="utf-8">
  
  <title>第 7 页 | VikingWarlock | VKWK&#39;s blog</title>

  
  <meta name="author" content="Viking Warlock">
  

  
  <meta name="description" content="VikingWarlock&#39;s daily life and develop experience">
  

  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  

  <meta property="og:site_name" content="VikingWarlock"/>

  
  <meta property="og:image" content="/hexosource/favicon.ico"/>
  
  
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-5005349780815724",
    enable_page_level_ads: true
  });
</script>

  
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?223eea22355699157e147870eb124b24";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script>


  <link rel="manifest" href="/manifest.json">
  <link href="/hexosource/favicon.ico" rel="icon">

  <link rel="alternate" href="/hexosource/atom.xml" title="VikingWarlock" type="application/atom+xml">
  <link href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/hexosource/css/base/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/hexosource/css/style.css" media="screen" type="text/css">


<meta name="generator" content="Hexo 5.3.0"></head>


<body>
<div class="blog">
  <div class="content">

    

    <header class="header-container" style="background-image: url('/images/blog-bg.jpg');">


<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <div class="navbar-header page-scroll">
          <button type="button" id="tglBtn" class="navbar-toggle">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">Viking Warlock</a>
        </div>
        <div id="bosenyblog-navbar">
          <div class="navbar-collapse" id="bs-example-navbar-collapse-6">
            <ul class="nav navbar-nav navbar-right">
            
              <li><a href="/hexosource/">主页</a></li>
            
              <li><a href="/hexosource/archives">归档</a></li>
            
              <li><a href="/hexosource/about">关于</a></li>
            
              <li><a href="/hexosource/tags">标签</a></li>
            
            </ul>
          </div>
        </div>

    </div>
 </nav>
 <div class="gotop-btn">

 </div>
</header>

        
        <div class="container ">
          <div class="row">
            <main class="site-main posts-loop    col-lg-8 col-lg-offset-1
                    col-md-8 col-md-offset-1
                    col-sm-12
                    col-xs-12">
            
  <article class="article-container ">

  
    
    <h3 class="article-title"><a href="/hexosource/programming/20160904-ble-ad-data.html"><span>BLE的广播帧</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/hexosource/programming/20160904-ble-ad-data.html" rel="bookmark">
        <time class="entry-date published" datetime="2016-09-03T17:36:15.000Z">
          2016-09-04
        </time>
      </a>
    </span>
    <br />
    
  </div>


  

  <div class="article-content">
    <div class="entry">
      
          <p>之前还以为BLE也就GATT那些东西嘛,没什么好说的了</p>
<p><code>其实</code></p>
<p>BLE或者说,蓝牙,的广播帧还是有很多很多奥秘的.还是有些东西可以拿来琢磨琢磨,学习学习</p>
<h3 id="Context"><a href="#Context" class="headerlink" title="Context"></a>Context</h3><p>至于为什么要突然学习这个东西,肯定是和新产品有关系的,具体的,可以等上市之后,买来一个试试看啊,哈哈哈哈哈哈</p>
<p>另一个原因,这个东西的官方文档真的很难找,至少在 <a href="http://www.bluetooth.com" target="_blank" rel="noopener">www.bluetooth.com</a> 上面我就没有看到讲述广播帧结构的文档,最后在TI的一个文档中,终于找到了相关的内容.</p>
<p>平时用BLE只要是在连接成功之后,搜索Service和Characteristc,后进行读写操作.这样的工作模式,只能一对一,不能做到一对多.但是利用了广播信息,可以做到一对多的发送消息…虽然这时候不能反过来写入.</p>
<h3 id="Let’s-go"><a href="#Let’s-go" class="headerlink" title="Let’s go"></a>Let’s go</h3><p>我们先来上一张图片,看看Bluetooth到底广播了什么吧</p>
<p><img src="http://vvk.ixuanlun.com/bluetoothAD_Data.png" alt="AD"></p>
<p>我是做上位机软件开发的,所以只关心应用层的东西,那么上面图片中,iOS和Android能被处理的数据是标红的那一段</p>
<p>一共31个字节,看起来好像不是很足够,但是由于协议是规定好了的,所以对应的位置表示对应的数据,还是够用的.</p>
<p>说说我们熟悉的一些广播信息吧:(iOS端CoreBluetooth的广播帧字典的Key)</p>
<pre><code>1.LocalName (外设名称)
2.ServiceUUIDs (Service列表)
3.ManufacturerData (制造商数据)
4.IsConnectable (是否可连)
</code></pre><p>下面再给点儿我第一次知道的广播信息类型:</p>
<pre><code>1.ServiceData (某个Service的广播数据)
2.TxPowerLevel (传输信号强度~.~,用来计算损耗用...好像暂时没啥用处,反正我也不会算)
3.OverflowServiceUUIDs (没懂他和ServiceUUIDs的区别~.~)
4.SolicitedServiceUUIDs (貌似和从设备没啥关系~.~)
</code></pre><p>说实话,平时用到的只有ServiceUUIDs,因为我们用这个来过滤出来我们需要的蓝牙外设,也用这个来区分不同的硬件.</p>
<p>LocalName的话iOS和Android都已经自动提取并封装成简单的接口了</p>
<p>上面是软件层面的东西,我们来看看硬件层面的呗~</p>
<p>一个广播帧会有很多类型的数据,每个类型有自己的<code>type</code>,上位机也是通过type字段来分辨数据是UUID还是Name或者其他的东西~</p>
<p>每一类数据都由3部分组成:</p>
<pre><code>1.length of data (这个type的总长度)
2.type (定义type)
3.data (根据type的协议来填入数据)
</code></pre><p>这里简单的列举几个type:</p>
<pre><code>0x02 不完整的16位UUID
0x04 不完整的32位UUID
0x06 不完整的128位UUID
0x08 设备全名
0x16 16位UUID的Service Data
0x20 32位UUID的Service Data
0x21 128位UUID的Service Data
0xFF 制造商自定义的数据
</code></pre><h4 id="Example-of-Peripheral-and-Bluetooth-Central"><a href="#Example-of-Peripheral-and-Bluetooth-Central" class="headerlink" title="Example of Peripheral and Bluetooth Central"></a>Example of Peripheral and Bluetooth Central</h4><p>一台名叫VK的外设,公布了一个Service UUID <code>3344</code>,<code>5566</code>;其中<code>3344</code>的Service Data是”0xAA,0xBB,0xCC”,制造商的自定义数据是”0x12,0x34,0x56,0x78”</p>
<p>那么他的广播数据是~</p>
<pre><code>04 08 56 4B 05 02 44 33 66 55 06 16 44 33 cc bb aa 07 FF 00 00 78 56 34 12
</code></pre><p>拆分数据分析分析</p>
<pre><code>04 08 56 4B
长度4 设备完整名称 V K

05 02 44 33 66 55
长度5 不完整的16位列表 3344 5566

06 16 44 33 cc bb aa
长度6 16位UUID的ServiceData UUID=3344 数据是 AA BB CC

07 FF 00 00 78 56 34 12
长度7 厂商自定义数据 厂商ID=0000 厂商自定义数据=12345678
</code></pre><p><code>如果有错误不要打我…</code></p>
<p>iOS端解析广播数据</p>
<pre><code>-(void)centralManager:(CBCentralManager *)central didDiscoverPeripheral:(CBPeripheral *)peripheral advertisementData:(NSDictionary&lt;NSString *,id&gt; *)advertisementData RSSI:(NSNumber *)RSSI
{
    // 名字的字符串
    NSLog(@&quot;Name %@&quot;,advertisementData[CBAdvertisementDataLocalNameKey]);
    // CBUUID的NSArray
    NSLog(@&quot;Service UUID %@&quot;,advertisementData[CBAdvertisementDataServiceUUIDsKey]);
    // Key为CBUUID,Value为NSData的NSDictionary
    NSLog(@&quot;Service Data %@&quot;,advertisementData[CBAdvertisementDataServiceDataKey]);
    // 制造商的数据NSData
    NSLog(@&quot;ManufacturerData %@&quot;,advertisementData[CBAdvertisementDataManufacturerDataKey]);
}
</code></pre><p>Android端解析</p>
<pre><code>@Override
    public void onLeScan(final BluetoothDevice device, int rssi,
            byte[] scanRecord) {
        // scanRecord 就是所有的广播数据呗
   }
</code></pre><p>iOS端为了隐私保护,做了各种各样奇怪的限定,所以不像Android那么爽,可以直接把广播帧的字节流都提取出来,所以就只能好好阅读协议,才能让iOS的App获取到想要的数据</p>
<p>相同的,Android虽然数据很开放,下位机可以不按照BLE协议去设置广播数据,Android App依然可以读得出来数据,但是解析数据就很头疼的样子了.</p>
<p>嗯,各有各的好处~</p>
<h4 id="BTW"><a href="#BTW" class="headerlink" title="BTW"></a>BTW</h4><p>其中一个type是</p>
<pre><code>0x17  Public Target Address
目标Mac地址
</code></pre><p>官方定义是</p>
<p>The Public Target Address data type defines the address of one or more intended recipients of an advertisement when one or more devices were bonded using a public address. This data type is intended to be used to avoid a situation where a bonded device unnecessarily responds to an advertisement intended for another bonded device.</p>
<h4 id="what-are-you-弄啥嘞…"><a href="#what-are-you-弄啥嘞…" class="headerlink" title="what are you 弄啥嘞…"></a>what are you 弄啥嘞…</h4><p>我YY他的用处就是,这个BLE设备只能被<code>指定Mac地址</code>的主机连接.</p>
<p>好啦,这次又学到了一点儿蓝牙的知识,写个文章当笔记.</p>

      
    </div>
    
  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/hexosource/categories/programming/">编程</a>
    </span>
    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/hexosource/tags/ble/">蓝牙</a>
    </span>
    

    </div>

    
  </div>
  
    
    <h3 class="article-read"><a href="/hexosource/programming/20160904-ble-ad-data.html"><span>点击阅读</span></a></h3>
    
  
</article>





  <article class="article-container ">

  
    
    <h3 class="article-title"><a href="/hexosource/wtf/20160901-conflicts-and-conflicts.html"><span>纠结的随想</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/hexosource/wtf/20160901-conflicts-and-conflicts.html" rel="bookmark">
        <time class="entry-date published" datetime="2016-09-01T01:10:13.000Z">
          2016-09-01
        </time>
      </a>
    </span>
    <br />
    
  </div>


  

  <div class="article-content">
    <div class="entry">
      
          <h3 id="矛盾存在于一切事物中-并且贯穿于事物发展过程的始终-即矛盾无处不在-矛盾无时不有"><a href="#矛盾存在于一切事物中-并且贯穿于事物发展过程的始终-即矛盾无处不在-矛盾无时不有" class="headerlink" title="矛盾存在于一切事物中,并且贯穿于事物发展过程的始终,即矛盾无处不在,矛盾无时不有"></a>矛盾存在于一切事物中,并且贯穿于事物发展过程的始终,即矛盾无处不在,矛盾无时不有</h3><p>这矛盾,大概也称为<code>纠结</code></p>
<p>我们每天都可能纠结很多的事情,有的是大事儿,有的是小事儿.小事儿也可以称为<code>矫情</code> ,比如说:</p>
<pre><code>1.今天吃咩啊?
2.看哪部电影啊?
3.今天要不要洗衣服啊?
4.....
</code></pre><p>这些矫情的小矛盾出现在~选择困难症的人的日常生活中,或者当一件事情的两个选项,会牵扯到另外一些矫情的事情的时候</p>
<h3 id="上面都是废话"><a href="#上面都是废话" class="headerlink" title="上面都是废话"></a>上面都是废话</h3><p>这篇日志,主要是说说最近遇到的一些小故事吧</p>
<h4 id="麦当劳不搭配套餐事件"><a href="#麦当劳不搭配套餐事件" class="headerlink" title="麦当劳不搭配套餐事件"></a>麦当劳不搭配套餐事件</h4><p>某一天去麦当劳,前面排着一个老奶奶,拿着一张餐巾纸,上面写着:</p>
<pre><code>巨无霸,鸡翅,可乐,大鸡排
</code></pre><p>老奶奶拿出老花眼镜来慢吞吞的读着纸巾上的字,收银员有点儿不耐烦,于是就直接看着纸巾帮她点餐了.</p>
<p>我看着纸巾上的内容,觉得有点儿眼熟,好像是一个套餐+大鸡排,但是服务员最后给的价格远远超出我的想象,<code>50+</code></p>
<p>这时候我的大脑开始了严密而紧张的计算,最后得出结论,如果不用单点,而是使用套餐,可以节省9元钱左右</p>
<p><code>这貌似和本文又无关了</code></p>
<p>No,我计算完毕并且验算完毕之后,一直很纠结,要不要当着大家的面指出这个事情呢?</p>
<p>我总觉得他们是在欺负老人,我最讨厌欺负老人的人了.</p>
<p>往往在这内心矛盾,纠结选项的时候,事情就过去了.老奶奶拿着食物离开了餐厅.</p>
<p>这件事情我憋了很久.或许正如一个朋友说的那样,收营员不熟悉菜单,不知道这个是套餐;又或许和我的理解一样,收营员是故意的,觉得老奶奶没说起,就不用管她.</p>
<p>归根结底,假如收银机智能一些,自动的规划成套餐;假如我早一点儿看透这一切,帮老奶奶来点餐.说不定也不至于这么耿耿于怀了吧~</p>
<h4 id="开学之各种纠结的事情"><a href="#开学之各种纠结的事情" class="headerlink" title="开学之各种纠结的事情"></a>开学之各种纠结的事情</h4><p>开学是个新的开始,一旦出现新的开始,大家就会忙着制定计划,这时候也会纠结迷茫.</p>
<h5 id="有的人纠结事情多-不知道怎么分配精力"><a href="#有的人纠结事情多-不知道怎么分配精力" class="headerlink" title="有的人纠结事情多,不知道怎么分配精力"></a>有的人纠结事情多,不知道怎么分配精力</h5><h5 id="有的人纠结未来能做些什么"><a href="#有的人纠结未来能做些什么" class="headerlink" title="有的人纠结未来能做些什么"></a>有的人纠结未来能做些什么</h5><h5 id="有的人同时纠结上述两项"><a href="#有的人同时纠结上述两项" class="headerlink" title="有的人同时纠结上述两项"></a>有的人同时纠结上述两项</h5><p>来一句虽然有点儿难听,但是却又很真实的话</p>
<pre><code>正正常常的读完大学依然不知道,自己可以做什么,自己会什么
</code></pre><p>这样的事情在我们IEC也会出现~</p>
<p>当然IEC的孩子不会不知道自己可以做什么,毕竟在IEC坚持下来的孩子,都能写得一手好代码,出去做个程序员,不是什么大问题</p>
<p>可即便如此,他们还是会在读研,出国,工作三者中纠结.</p>
<p>各有各的好,各有各的不好.出国比国内读研牛逼,但是费钱;读研比工作轻松,但是没有钱挣,过得很拮据</p>
<p>刚加入不久的孩子会在学业,课余生活和编程的权重比例上面纠结很久</p>
<p>听到他们在纠结的时候,我总是会觉得:这种事儿有什么好纠结的呢?</p>
<p>然而自己在两年前,也因为纠结这件事情,走了很多很多的弯路.</p>
<p><code>现在</code>我来充当一下老司机吧~</p>
<p>没什么好纠结的!选择一个目标,不要改变,往下走,往里钻,一定会搞出些名堂的!</p>
<h4 id="最后是自己纠结的事情"><a href="#最后是自己纠结的事情" class="headerlink" title="最后是自己纠结的事情"></a>最后是自己纠结的事情</h4><p><code>这</code>可能是第一次,我不纠结学习和工作的事情……</p>
<h5 id="因为"><a href="#因为" class="headerlink" title="因为,"></a>因为,</h5><p>这次是玩耍和工作起了矛盾~</p>
<p>回想一下大学的4年,我从来没有离开过成都.没有看过大熊猫,没有去过锦里,没有去过各种名胜古迹.反而是其他城市读书的同学走过的地方更多,每次被杭州的朋友或者亲戚问起,成都好玩不?四川好玩不?</p>
<p>我总是无言以对,笑笑说,平时太忙了,没时间去玩.</p>
<p>其实,这并不是假话~</p>
<p>作业,工作,确实占用了很多的时间,而且把时间剁碎了,变得碎片化,找不到完整的可以用来出游的完整时间.</p>
<p>大概是应该我的性格,所以我没有崩溃,没有抑郁,反而津津乐道,觉得很有成就感.</p>
<p>可是今天听到了 <code>起风了</code> 里面的主题曲,突然脑子里面就是电影的画面,男主角是个牛逼的工程师,每天有画不完的图纸.但是他又经常可以在草原上看着飞机飞,可以感受风,可以用风来洗净自己,让自己可以在黑暗丑陋的时代里依旧很干净</p>
<p>当然,我没有那么高尚.只是我突然发现,自己并不是可以不用玩耍的人,我虽然喜欢工作,但也喜欢干净安静的风景,总给我一种很舒服的感觉,让我可以放松一下紧绷的心</p>
<h3 id="今天话很多啊"><a href="#今天话很多啊" class="headerlink" title="今天话很多啊"></a>今天话很多啊</h3><h4 id="最近写的代码-没啥技术含量-不说也罢-所以就来”文艺”一下自己"><a href="#最近写的代码-没啥技术含量-不说也罢-所以就来”文艺”一下自己" class="headerlink" title="最近写的代码,没啥技术含量,不说也罢,所以就来”文艺”一下自己"></a>最近写的代码,没啥技术含量,不说也罢,所以就来”文艺”一下自己</h4><h4 id="等这段时间的感性期过了-就可以继续post一些技术文章咯"><a href="#等这段时间的感性期过了-就可以继续post一些技术文章咯" class="headerlink" title="等这段时间的感性期过了,就可以继续post一些技术文章咯~"></a>等这段时间的感性期过了,就可以继续post一些技术文章咯~</h4>
      
    </div>
    
  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/hexosource/categories/wtf/">什么鬼</a>
    </span>
    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/hexosource/tags/diary/">日记</a>
    </span>
    

    </div>

    
  </div>
  
    
    <h3 class="article-read"><a href="/hexosource/wtf/20160901-conflicts-and-conflicts.html"><span>点击阅读</span></a></h3>
    
  
</article>





  <article class="article-container ">

  
    
    <h3 class="article-title"><a href="/hexosource/wtf/20160831-new-start-master.html"><span>开始研究生活</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/hexosource/wtf/20160831-new-start-master.html" rel="bookmark">
        <time class="entry-date published" datetime="2016-08-31T00:40:14.000Z">
          2016-08-31
        </time>
      </a>
    </span>
    <br />
    
  </div>


  

  <div class="article-content">
    <div class="entry">
      
          <p>假期还是结束了,又回到了”熟悉”的校园,搬了两天的家,出了几顿的汗水.</p>
<p>躺下来的时候,发现,枕头没有,先垫几块布凑活凑活吧~</p>
<p>刚打开研究生寝室的门,我就惊呆了,这也忒小了吧…比本科生寝室的一半还要小…</p>
<p>不过通宵供电和超级爽的澡堂还不错,再也不用担心回到寝室,睁眼黑.也不用担心在浴室打开龙头出来的永远是冷水~</p>
<p>研究生的课表真的很恼火,培养方案特别难理解,只能走一步看一步了.</p>
<p>虽然我已经本科毕业了,但是还是很喜欢IEC的氛围,放心,我不会走的,哈哈哈,我要来充当2016级新生.</p>
<p>开学总是斗志满满的.一开学脑子里面就浮现出来了超级大学霸:赫敏.觉得自己也能和她一样不仅可以搞定很多很多课,而且还能兼顾公司的产品.不过,我确定,自己是没有这个水平的…</p>
<p>说到公司,我确实得在后面几天考虑考虑时间的分配,不然,会辜负SUP这个职称的!</p>
<p>这,已经开学5天了,我数了数,还是有一大堆事情没做,看来神经还没有绷紧.</p>
<p>不知道刚开学的你们,感觉如何,要不要也来好好地规划一下未来这几个月的生活呢?</p>
<p><code>VKWKMDZZ</code></p>

      
    </div>
    
  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/hexosource/categories/wtf/">什么鬼</a>
    </span>
    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/hexosource/tags/diary/">日记</a>
    </span>
    

    </div>

    
  </div>
  
    
    <h3 class="article-read"><a href="/hexosource/wtf/20160831-new-start-master.html"><span>点击阅读</span></a></h3>
    
  
</article>





  <article class="article-container ">

  
    
    <h3 class="article-title"><a href="/hexosource/life/20160824-tired-prison-life.html"><span>监狱生活</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/hexosource/life/20160824-tired-prison-life.html" rel="bookmark">
        <time class="entry-date published" datetime="2016-08-23T22:07:17.000Z">
          2016-08-24
        </time>
      </a>
    </span>
    <br />
    
  </div>


  

  <div class="article-content">
    <div class="entry">
      
          <h3 id><a href="#" class="headerlink" title="~.~"></a>~.~</h3><p>这次JCY的项目总让我觉得和当年乐山的项目很像,</p>
<p><code>甲方都很变态！！</code></p>
<p>工期大幅度缩短,10月-&gt;9月-&gt;8月底-&gt;周一(那一周的周一)</p>
<p>功能也乱改,于是最终版出来的时候,我发现,我好像写了好多接口,最后都不用了～</p>
<p>于是我生气的不给你装PostGRE SQL,不给你装FastCGI！</p>
<p>JCY的办公室里面都开着空调,然而我的汗还是没有停过,感觉把一年的汗都流完了.</p>
<h3 id="OK-讲讲故事吧"><a href="#OK-讲讲故事吧" class="headerlink" title="OK,讲讲故事吧"></a>OK,讲讲故事吧</h3><p>第二次使用windows server,也是第一次在windows server上面安装python,双击python的window安装包,一阵狂按回车,表现出很熟练的样子,然后…</p>
<p><code>boom</code>  安装卡在了奇怪的地方</p>
<pre><code>There is a problem with widows installer package,a program run as part of setup did not finish as excepted. contact your support personnel or package vendor. 
</code></pre><p>于是,进度条就退了回去.</p>
<p>然后,我就试了试32位的安装包,依然卡在了奇怪的地方,又退了回去.</p>
<p>注意到一个细节:</p>
<p>以前安装的时候好像会弹出一个控制台,在安装setuptool和pip,但是这次并没有弹出,所以我估摸着,是pip的问题,所以新的安装的时候,我把pip去掉了,于是神奇的成功了～</p>
<p>当然,没有pip和setuptool的话,就不能安装其他的模块了呢,所以只能再打开一次安装程序,安装pip.这次竟然没有错误！哈哈哈哈哈哈</p>
<p>于是就这么成功的搭建完毕.</p>
<h3 id="JCY的食堂我竟然觉得还蛮好吃的～～"><a href="#JCY的食堂我竟然觉得还蛮好吃的～～" class="headerlink" title="JCY的食堂我竟然觉得还蛮好吃的～～"></a>JCY的食堂我竟然觉得还蛮好吃的～～</h3><h3 id="At-Last"><a href="#At-Last" class="headerlink" title="At Last"></a>At Last</h3><p>求这个活儿赶紧结束,放我回家</p>

      
    </div>
    
  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/hexosource/categories/life/">日记</a>
    </span>
    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/hexosource/tags/diary/">日记</a>
    </span>
    

    </div>

    
  </div>
  
    
    <h3 class="article-read"><a href="/hexosource/life/20160824-tired-prison-life.html"><span>点击阅读</span></a></h3>
    
  
</article>





  <article class="article-container ">

  
    
    <h3 class="article-title"><a href="/hexosource/programming/20160822-from-linux-to-windows.html"><span>django服务器从linux迁移到windows</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/hexosource/programming/20160822-from-linux-to-windows.html" rel="bookmark">
        <time class="entry-date published" datetime="2016-08-21T19:21:37.000Z">
          2016-08-22
        </time>
      </a>
    </span>
    <br />
    
  </div>


  

  <div class="article-content">
    <div class="entry">
      
          <h2 id="教研室接了一个检察院的项目"><a href="#教研室接了一个检察院的项目" class="headerlink" title="教研室接了一个检察院的项目"></a>教研室接了一个检察院的项目</h2><h4 id="老实说-这个项目坑爆了"><a href="#老实说-这个项目坑爆了" class="headerlink" title="老实说,这个项目坑爆了"></a>老实说,这个项目坑爆了</h4><p>一开始说可以提供一个全新的服务器,系统也是我们来定,于是,嫌弃windows的我在Linux上面很熟练的搭建起服务器来</p>
<h4 id="直到…"><a href="#直到…" class="headerlink" title="直到…"></a>直到…</h4><p>有一天,他们的技术人员告诉我 “由于经费紧张,咱们就不能买新的服务器了,以前的服务器你想要什么系统都可以”</p>
<p>于是报了三个Windows Server的版本给我…</p>
<h4 id="好吧-反正我也没的选-那就先看看改到windows上面有哪些改变吧"><a href="#好吧-反正我也没的选-那就先看看改到windows上面有哪些改变吧" class="headerlink" title="好吧,反正我也没的选,那就先看看改到windows上面有哪些改变吧?"></a>好吧,反正我也没的选,那就先看看改到windows上面有哪些改变吧?</h4><p><code>Context</code> 那边的服务器由于安全问题,是不允许接入外网的</p>
<p>所以PIP都不能用了,所以先把需要的包给下了吧,什么Django,Arrow,Python-DateUtil……</p>
<p>windows上面没有uwsgi,那就用FastCGI吧</p>
<h4 id="想得美-我才不为了你单独去搞FastCGI呢-Django跑跑就够了！！"><a href="#想得美-我才不为了你单独去搞FastCGI呢-Django跑跑就够了！！" class="headerlink" title="想得美,我才不为了你单独去搞FastCGI呢,Django跑跑就够了！！"></a>想得美,我才不为了你单独去搞FastCGI呢,Django跑跑就够了！！</h4><p>Nginx还是要的,不然我还得在django里面写下载接口,好在Nginx是有Windows版的 <code>good job</code></p>
<h4 id="等下"><a href="#等下" class="headerlink" title="等下"></a>等下</h4><p>Windows 没有自带 Python ～～</p>
<p>为了保险起见,把32位的和64位的都下载下来</p>
<p><code>Context</code> 他们是不允许使用优盘的,所以一切的一切,都只能使用刻录的光盘…</p>
<p>OK,前面基本都是废话,简单说,就是在Windows上面装环境啦…</p>
<h2 id="代码改动"><a href="#代码改动" class="headerlink" title="代码改动?"></a>代码改动?</h2><p>嗯,上传文件接口,Django的Media_Root需要改个位置,当然Nginx的下载地址要改个位置,还有之前使用uwsgi的,现在得换成Django</p>
<p>windows的nginx貌似是不会自动选择conf/nginx.cfg,所以启动的时候还得手动写</p>
<pre><code>nginx.exe -c conf/nginx.cfg
</code></pre><p>本来是用uwsgi的,那现在就直接Django启动到指定端口</p>
<pre><code>python manage.pyc runserver 9999
</code></pre><p>哦哦哦,pyc文件的生成方法也很重要,毕竟这个项目xxxx,所以我还是选择不提供源代码给他们.</p>
<p>那就得编译一下再给他们</p>
<pre><code>python -m py_compile manage.py
</code></pre><p>以此类推,把他们都编程编译过的文件</p>
<h2 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h2><p>linux下一个路径是<br>    xxx/xxx/xxx</p>
<p>windows下一个路径是</p>
<pre><code>X:\xxx\xxx
</code></pre><p>你以为修改django代码的时候就应该把</p>
<pre><code>xxx/xxx/xxx 改成 X:\xxx\xxx
</code></pre><p>其实…还是</p>
<pre><code>X:/xxx/xxx
</code></pre><p>本来打算写一个shell来自动安装的,现在看来,只能写成bat文件了～</p>
<p>由于msi的安装不会用bat来做,所以还是手动安装一下比较好</p>
<pre><code>@echo &quot;Start Unzip python packages&quot;
Unzip Django-1.9.9.zip -d C:\
Unzip python-dateutil-patches-for-1.5 -d C:\
Unzip arrow-master -d C:\
@echo &quot;Install Nginx&quot;
Unzip nginx-1.11.3 -d C:\
@echo &quot;install python packages&quot;
python C:\Django-1.9.9\setup.py install
python C:\python-dateutil-patches-for-1.5\setup.py install
python C:\arrow-master\setup.py install
@echo &quot;Copy Nginx configure file&quot;
copy nginx.cfg C:\nginx-1.11.3\conf\nginx.cfg
@echo &quot;build download folder&quot;
md &quot;C:\file&quot;
</code></pre><p>在启动之前添加一些用户,然后就能启动了.</p>
<p>windows server还是适合使用windows自己的服务器～ASP.net</p>

      
    </div>
    
  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/hexosource/categories/programming/">编程</a>
    </span>
    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/hexosource/tags/python/">Python</a>
    </span>
    

    </div>

    
  </div>
  
    
    <h3 class="article-read"><a href="/hexosource/programming/20160822-from-linux-to-windows.html"><span>点击阅读</span></a></h3>
    
  
</article>





  <article class="article-container ">

  
    
    <h3 class="article-title"><a href="/hexosource/programming/20160815-bluetooth-speeder.html"><span>蓝牙测速</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/hexosource/programming/20160815-bluetooth-speeder.html" rel="bookmark">
        <time class="entry-date published" datetime="2016-08-14T22:45:57.000Z">
          2016-08-15
        </time>
      </a>
    </span>
    <br />
    
  </div>


  

  <div class="article-content">
    <div class="entry">
      
          <p>之前的文章中介绍过蓝牙的速度和踏频协议,在那篇文章中也顺便介绍了BLE的一些小名词.这一篇文章就来说说炫轮App 3.0中的测速模块是怎么构成的吧.</p>
<h2 id="Context"><a href="#Context" class="headerlink" title="Context"></a>Context</h2><h4 id="炫轮App可以获取到哪些传感器的数据呢？"><a href="#炫轮App可以获取到哪些传感器的数据呢？" class="headerlink" title="炫轮App可以获取到哪些传感器的数据呢？"></a>炫轮App可以获取到哪些传感器的数据呢？</h4><ol>
<li>炫轮车灯自身的码表数据</li>
<li>炫轮踏频器</li>
<li>满足公有踏频速度协议的传感器</li>
<li>GPS</li>
</ol>
<h4 id="他们的数据是些什么？"><a href="#他们的数据是些什么？" class="headerlink" title="他们的数据是些什么？"></a>他们的数据是些什么？</h4><p><code>1.炫轮车灯的数据</code></p>
<p>炫轮车灯会通过蓝牙得到每转一圈需要的时间</p>
<p><code>2.炫轮踏频器</code></p>
<p>这个产品不测速,所以先不多说～</p>
<p><code>3.满足公有协议的踏频速度传感器</code></p>
<p>通过蓝牙得到在第x秒转了y圈的信息</p>
<p><code>4.GPS</code></p>
<p>GPS数据本身就携带了速度信息,只不过,如果GPS信号不强,那这个数据就会不精准</p>
<h4 id="再来个附加功能"><a href="#再来个附加功能" class="headerlink" title="再来个附加功能"></a>再来个附加功能</h4><p>大多数的骑行App的一次运动运动时间是手动点击开始,暂停,保存来记录的.这样不是很难过嘛？我想要个自动开始,自动暂停的码表！</p>
<p>不用往下翻,我没写～～这只是打个<a href="http://ixuanlun.com" target="_blank" rel="noopener">广告</a></p>
<h2 id="Structure"><a href="#Structure" class="headerlink" title="Structure"></a>Structure</h2><p>所以和速度有关的传感器目前为止大概是那么3类: 炫轮车灯,满足公有协议的速度计,GPS</p>
<p>既然,GPS那么不稳定,干脆砍掉算了.</p>
<p>所以问题就变成了,如何根据炫轮车灯和速度计来计算出较为准确地速度.</p>
<hr>
<h3 id="Structure-Context"><a href="#Structure-Context" class="headerlink" title="Structure-Context"></a>Structure-Context</h3><p>App 可以连接两个炫轮车灯,一个速度计</p>
<p>码表模块是和界面分离的,把他当做服务来处理(这里我写了一个单例),这个类可以收数据,也可以被获取数据.收到的自然是解析后的炫轮数据和速度计的数据,提供获取接口的是多种单位下的:当前速度,平均速度,总路程,总运动时间,(当然还有踏频和心率,只是这里不用,所以就不说了)</p>
<hr>
<h3 id="全局变量"><a href="#全局变量" class="headerlink" title="全局变量"></a>全局变量</h3><p>计时器1枚,记录炫轮数据的数组2枚,记录速度计的数据的数组1枚.</p>
<p>其他的变量这篇文章用不到,就当他不存在了</p>
<pre><code>-(void)updateXuanwheelSpeed:(NSTimeInterval)timeinterval ForPosition:(int)position
{
    switch (position) {
        case 0:
        {
            //########
            [xuanWheelTemporaryList addObject:@(timeinterval)];
            xuanwheelRevolution1++;
            //########
            break;
        }
        case 1:
        {
            //########
            [xuanWheelTemporaryList addObject:@(timeinterval)];
            xuanwheelRevolution2++;
            //########
            break;
        }
        default:
            break;
    }    
}
</code></pre><p>这是处理炫轮数据的方法,把一圈的时间间隔记录下来,分开写是因为要分别记录两个轮子转的圈数,帮助计算距离.</p>
<pre><code>-(void)updateSpeeder:(Float32)frequency
{
    //########
    [publicTemporaryList addObject:@(frequency)];
}
</code></pre><p>公有协议的数据,我在这之前就一经计算好了转一圈的频率.已知在第X1秒转了Y1圈,在X2秒转了Y2圈.那么频率就是<code>(X1-X2)/(Y1-Y2)</code></p>
<p>记录完毕数据,就该计算相关信息了</p>
<h2 id="Calculate"><a href="#Calculate" class="headerlink" title="Calculate"></a>Calculate</h2><pre><code>-(void)optimizeSpeed
{
    if (######) {
        //....
    }else
    {
        //#####
        //Reason1:只有一组数据,还怎么计算平均速度;Reason2:#####
        if (publicTemporaryList.count&gt;1||xuanWheelTemporaryList.count&gt;1) {
            int count=0;
            //time用来存放这1秒内平均的转过1圈需要的时间
            NSTimeInterval time=0;
            for(NSNumber *item in publicTemporaryList)
            {
                //这里来计算公有协议的速度信息
                if (item.floatValue&gt;5) {
                    //这么慢还是忽略吧
                    continue;
                }
                if (item.floatValue&lt;=0) {
                    //谁解析的数据！！
                    continue;
                }
                time+=1.f/item.floatValue;
                count++;
            }
            if (publicTemporaryList.count&gt;0) {
                if (publicTemporaryList.count&gt;1) {
                    [publicTemporaryList removeObjectsInRange:NSMakeRange(0, publicTemporaryList.count-1)];
                }else
                {
                    [publicTemporaryList removeAllObjects];
                }
                //算完删光,留下一组数据,为下一秒做帮助,防止突变
            }
            for(NSNumber *item in xuanWheelTemporaryList)
            {
                //这里来计算炫轮的速度信息
                if (item.floatValue&gt;5) {
                    continue;
                }
                if (item.floatValue&lt;=0) {
                    continue;
                }
                time+=item.floatValue;
                count++;
            }
            if (xuanWheelTemporaryList.count&gt;0) {
                if (xuanWheelTemporaryList.count&gt;1) {
                    [xuanWheelTemporaryList removeObjectsInRange:NSMakeRange(0, xuanWheelTemporaryList.count-1)];
                }else
                {
                    [xuanWheelTemporaryList removeAllObjects];
                }
                //Again,留一组数据来备用
            }
            if (count==0||time==0) {
                currentS=0;
            }else
                currentS=[PublicResource sharedObject].roundLength*count/time*3600;
                //这个就是这1秒的速度了咯
        }else
        {
            //#####
        }
    }
//最新的最高速度
    if (currentS&gt;max_inner_speed) {
        max_inner_speed=currentS;
    }
//防止速度突变
    if (currentS&gt;lastSpeed+30) {
        lastSpeed=currentS;
        currentS=0;
    }
//强制限速
    if (currentS&gt;80) {
        currentS=80;
    }
}
</code></pre><p>差不多,速度就是这么计算的,在实际测试中,感觉还是满准确地～</p>

      
    </div>
    
  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/hexosource/categories/programming/">编程</a>
    </span>
    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/hexosource/tags/ble/">蓝牙</a>
    </span>
    

    </div>

    
  </div>
  
    
    <h3 class="article-read"><a href="/hexosource/programming/20160815-bluetooth-speeder.html"><span>点击阅读</span></a></h3>
    
  
</article>





  <article class="article-container ">

  
    
    <h3 class="article-title"><a href="/hexosource/programming/20160812-python-handle-socket.html"><span>Python 处理字节流</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/hexosource/programming/20160812-python-handle-socket.html" rel="bookmark">
        <time class="entry-date published" datetime="2016-08-11T23:45:34.000Z">
          2016-08-12
        </time>
      </a>
    </span>
    <br />
    
  </div>


  

  <div class="article-content">
    <div class="entry">
      
          <h2 id="python处理字节的点点滴滴"><a href="#python处理字节的点点滴滴" class="headerlink" title="python处理字节的点点滴滴"></a>python处理字节的点点滴滴</h2><p>python有多爽,我就不说了,反正想得到的事情,基本都有办法用python来解决,当然还有一个很重要的优点: 写python不用编译～</p>
<h2 id="Context"><a href="#Context" class="headerlink" title="Context"></a>Context</h2><ol>
<li>之前毕业设计做的是<code>SMS4的实现与安全性分析</code>.安全性分析是什么鬼？查了查书,好像是用有特征的原文来进行测试……,具体的我也忘记了.当时就琢磨,怎么样可以做一个酷炫的安全性分析呢？</li>
<li>公司的新产品是一款智能硬件,它会通过<code>TCP</code>给服务器发送指令(当然不是熟悉的HTTP请求,是传说中的字节流)</li>
</ol>
<h2 id="Requirement"><a href="#Requirement" class="headerlink" title="Requirement"></a>Requirement</h2><ol>
<li>commands+re : 这个组合可以轻轻松松的提取出命令行程序的有用信息</li>
<li>binascii : 这个东西可以轻松的产生各种各样和二进制有关或者和ascii有关的字符串</li>
<li>struct : 超级牛逼的解包模块,瞬间把一个字节流解成元组</li>
</ol>
<h2 id="OK-Let’s-go"><a href="#OK-Let’s-go" class="headerlink" title="OK, Let’s go"></a>OK, Let’s go</h2><h4 id="commands-re"><a href="#commands-re" class="headerlink" title="commands+re"></a>commands+re</h4><p>commands.output(cmd),cmd是shell命令<code>我也不知道windows的命令可以不可以～～</code><br>这一条可以把运行结果返回出来(字符串形式)</p>
<p>然后用re来做正则匹配,再搭配一些split(),replace()之类的操作字符串的函数,就可以提取出一个命令行程序中有用的信息了.</p>
<h4 id="binascii"><a href="#binascii" class="headerlink" title="binascii"></a>binascii</h4><pre><code>binascii.b2a_hex(data)
binascii.hexlify(data)
</code></pre><p><code>data</code>就是原始字符串,假设就是”abcde”<br>返回的也是字符串,不过是16进制的字符串”6162636465”</p>
<pre><code>binascii.a2b_hex(hexstr)
binascii.unhexlify(hexstr)
</code></pre><p>这个函数就是反过来的<br>‘hexstr’是16进制的字符串,假定说是”6162636465”<br>返回的字符串就是他们所对应的ascii的字符,就是”abcde”</p>
<p>这有啥用嘞?</p>
<p><code>做测试！</code></p>
<p>让下位机发送一条指令可能还蛮复杂的,或者蛮浪费资源什么的,这样调试服务器代价会比较大.使用binascii来制作测试数据再好不过了.</p>
<p>假设下位机发送的数据是”0xaa,0xbb,0xcc,0x12,0x34,0xdd,0xee,0xff”</p>
<p>我们就可以模拟一条</p>
<pre><code>a=&quot;aabbcc1234ddeeff&quot;
b=asciibin.a2b_hex(a)
</code></pre><p>b就是模拟了服务器收到socket字节流.真方便</p>
<h4 id="struct"><a href="#struct" class="headerlink" title="struct"></a>struct</h4><p>收到字节流,根据协议,得知其中的8个字节是double,4个字节是float.</p>
<p>嗯,字节转整形还是有办法的,那么转成浮点型应该怎么转呢？？</p>
<p>import struct吧</p>
<p>将python数据封装成字节流</p>
<pre><code>struct.pack(format,argvs...)
</code></pre><p>将字节流解析成python数据类型</p>
<pre><code>struct.unpack(format,string)
</code></pre><p><code>format</code>很有意思,简单说就是解析规则.</p>
<p>比如解析成float,就写’f’</p>
<p>解析成double,就写成’d’</p>
<p>那么一个数据流里面既有float又有double怎么办呢?</p>
<p>嗯,截取字符串嘛！</p>
<pre><code>struct.unpack(&apos;f&apos;,s1[0:4])
struct.unpack(&apos;d&apos;,s1[4:12])
</code></pre><p>哈哈,我一开始也是这样写的,后面章鱼兄跟我说,format里面可以写很多东西</p>
<pre><code>struct.unpack(&apos;fd&apos;,s1)
</code></pre><p>这个会直接返回(r1,r2),其中r1就是那个float,r2就是那个double</p>
<p>真的好方便</p>
<p>附表一张</p>
<table>
<thead>
<tr>
<th>format</th>
<th>类型</th>
</tr>
</thead>
<tbody>
<tr>
<td>f</td>
<td>float</td>
</tr>
<tr>
<td>d</td>
<td>double</td>
</tr>
<tr>
<td>c</td>
<td>char</td>
</tr>
<tr>
<td>i</td>
<td>int</td>
</tr>
<tr>
<td>l</td>
<td>long</td>
</tr>
<tr>
<td>3s</td>
<td>长度为3的字符串</td>
</tr>
<tr>
<td>4s</td>
<td>长度为4的字符串</td>
</tr>
<tr>
<td>5s</td>
<td>长度为5的字符串</td>
</tr>
<tr>
<td>…</td>
<td>…</td>
</tr>
</tbody>
</table>
<p>至于struct.pack()嘛,既然format都有了,那么应该不难理解了,在python里面试一试就明白了</p>

      
    </div>
    
  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/hexosource/categories/programming/">编程</a>
    </span>
    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/hexosource/tags/python/">Python</a>
    </span>
    

    </div>

    
  </div>
  
    
    <h3 class="article-read"><a href="/hexosource/programming/20160812-python-handle-socket.html"><span>点击阅读</span></a></h3>
    
  
</article>





  <article class="article-container ">

  
    
    <h3 class="article-title"><a href="/hexosource/programming/20160726-wechat-develop-sucks.html"><span>微信服务号的消息处理</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/hexosource/programming/20160726-wechat-develop-sucks.html" rel="bookmark">
        <time class="entry-date published" datetime="2016-07-26T13:40:34.000Z">
          2016-07-26
        </time>
      </a>
    </span>
    <br />
    
  </div>


  

  <div class="article-content">
    <div class="entry">
      
          <h4 id="新产品会和微信公众号有交互-所以就来尝尝鲜-做一做微信公众号的各种东西"><a href="#新产品会和微信公众号有交互-所以就来尝尝鲜-做一做微信公众号的各种东西" class="headerlink" title="新产品会和微信公众号有交互,所以就来尝尝鲜,做一做微信公众号的各种东西."></a>新产品会和微信公众号有交互,所以就来尝尝鲜,做一做微信公众号的各种东西.</h4><p>首先:注册,认证,bla bla bla,设置一堆东西</p>
<p>在获得了开发权限之后,就可以仔细阅读开发文档了.</p>
<p>和微信的交互有两种：</p>
<ol>
<li>服务器给微信发送消息</li>
<li>微信给服务器发送消息</li>
</ol>
<p>说说他们的区别.</p>
<p>服务器给微信发消息,很方便,发表单格式的就行了,微信回复的是json格式的</p>
<p>微信服务器主动给服务器发消息,就很恶心了.</p>
<ol>
<li>如果在配置页面设置了消息模式是加密的,那么收到了微信的消息之后需要先对包进行解密,才能得知微信发送的消息的确切内容.</li>
<li>微信的每次请求,都需要按照和它一样的变态格式回复.</li>
<li>还得验证验证消息到底是不是微信发的～</li>
</ol>
<p>先来看看微信给服务器发的是什么样子的东西</p>
<pre><code>&lt;xml&gt;
&lt;ToUserName&gt;&lt;![CDATA[toUser]]&gt;&lt;/ToUserName&gt;
 &lt;FromUserName&gt;&lt;![CDATA[fromUser]]&gt;&lt;/FromUserName&gt;
&lt;CreateTime&gt;1348831860&lt;/CreateTime&gt;
 &lt;MsgType&gt;&lt;![CDATA[text]]&gt;&lt;/MsgType&gt;
 &lt;Content&gt;&lt;![CDATA[this is a test]]&gt;&lt;/Content&gt;
 &lt;MsgId&gt;1234567890123456&lt;/MsgId&gt;
 &lt;/xml&gt;
</code></pre><p>哦,这个是没加密的,加密的更难看…</p>
<p>应该用正则来提取内容吧,我把他们都写了出来,方便方便</p>
<pre><code>REGEX_TOUSERNAME = r&apos;\&lt;ToUserName\&gt;\&lt;\!\[CDATA\[(.*)\]\]\&gt;\&lt;\/ToUserName\&gt;&apos;
REGEX_FROMUSERNAME = r&apos;\&lt;FromUserName\&gt;\&lt;\!\[CDATA\[(.*)\]\]\&gt;\&lt;\/FromUserName\&gt;&apos;
REGEX_MSGTYPE = r&apos;\&lt;MsgType\&gt;\&lt;\!\[CDATA\[(.*)\]\]\&gt;\&lt;\/MsgType\&gt;&apos;
REGEX_EVENT = r&apos;\&lt;Event\&gt;\&lt;\!\[CDATA\[(.*)\]\]\&gt;\&lt;\/Event\&gt;&apos;
REGEX_EVENT_KEY = r&apos;\&lt;EventKey\&gt;\&lt;\!\[CDATA\[(.*)\]\]\&gt;\&lt;\/EventKey\&gt;&apos;
REGEX_SCANTYPE = r&apos;\&lt;ScanType\&gt;\&lt;\!\[CDATA\[(.*)\]\]\&gt;\&lt;\/ScanType\&gt;&apos;
REGEX_SCANRESULT = r&apos;\&lt;ScanResult\&gt;\&lt;\!\[CDATA\[(.*)\]\]\&gt;\&lt;\/ScanResult\&gt;&apos;
REGEX_CREATETIME = r&apos;\&lt;CreateTime\&gt;(.*)\&lt;\/CreateTime\&gt;&apos;
REGEX_CONTENT = r&apos;\&lt;Content\&gt;\&lt;\!\[CDATA\[(.*)\]\]\&gt;\&lt;\/Content\&gt;&apos;
</code></pre><p>还傻乎乎的搞了个类来解析这坨东西</p>
<pre><code>class wechat_xml_object(object):
    def __init__(self, xml):
        self.origin = str(xml)

    @property
    def toUserName(self):
        return self.returnValueForKey(REGEX_TOUSERNAME)

    @property
    def fromUserName(self):
        return self.returnValueForKey(REGEX_FROMUSERNAME)

    @property
    def msgType(self):
        return self.returnValueForKey(REGEX_MSGTYPE)

    @property
    def event(self):
        return self.returnValueForKey(REGEX_EVENT)

    @property
    def eventKey(self):
        return self.returnValueForKey(REGEX_EVENT_KEY)

    @property
    def scanType(self):
        return self.returnValueForKey(REGEX_SCANTYPE)

    @property
    def scanResult(self):
        return self.returnValueForKey(REGEX_SCANRESULT)

    @property
    def createTime(self):
        return self.returnValueForKey(REGEX_CREATETIME)

    @property
    def content(self):
        return self.returnValueForKey(REGEX_CONTENT)

    def returnValueForKey(self, regex):
        match = re.search(regex,self.origin)
        if match:
            return match.group(1)
        else:
            return None
</code></pre><p>虽然我知道有kissXML这种神器,但是我<code>懒</code>得装……</p>
<p>上面是把明文的XML解包出来,现在我们把想回复的数据给封装起来</p>
<pre><code>class wechat_xml_builder(object):
    def __init__(self, data_type):
        self.type = data_type
        self.content = &apos;&apos;
        self.contains = []

    def addObject(self, key, value, data_mark):
        if key in self.contains:
            return False
        if data_mark:
            self.content += &apos;&lt;{0}&gt;&lt;![CDATA[{1}]]&gt;&lt;/{2}&gt;&apos;.format(key, value, key)
        else:
            self.content += &apos;&lt;{0}&gt;{1}&lt;/{2}&gt;&apos;.format(key, value, key)
        self.contains.append(key)
        return True

    def add_default_from(self, dictionary):
        fromUser = dictionary[&apos;toUser&apos;]
        openid = dictionary[&apos;openid&apos;]
        createTime = dictionary[&apos;createTime&apos;]
        self.addObject(&apos;ToUserName&apos;, openid, True)
        self.addObject(&apos;FromUserName&apos;, fromUser, True)
        self.addObject(&apos;CreateTime&apos;, createTime, False)

    def exportString(self):
        return &apos;&lt;xml&gt;&apos; + self.content + &apos;&lt;/xml&gt;&apos;
</code></pre><p>我感觉这个类用起来还是蛮简单的.</p>
<p>至于说加密和解密,微信还是很良心的提供了一个库,可以直接操作.</p>
<p>下次再整理一下微信开发中其他的坑儿吧</p>

      
    </div>
    
  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/hexosource/categories/programming/">编程</a>
    </span>
    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/hexosource/tags/python/">Python</a>
    </span>
    

    </div>

    
  </div>
  
    
    <h3 class="article-read"><a href="/hexosource/programming/20160726-wechat-develop-sucks.html"><span>点击阅读</span></a></h3>
    
  
</article>





  <article class="article-container ">

  
    
    <h3 class="article-title"><a href="/hexosource/programming/20160601-ios-unit-test.html"><span>ios 命令行单元测试</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/hexosource/programming/20160601-ios-unit-test.html" rel="bookmark">
        <time class="entry-date published" datetime="2016-06-01T15:36:34.000Z">
          2016-06-01
        </time>
      </a>
    </span>
    <br />
    
  </div>


  

  <div class="article-content">
    <div class="entry">
      
          <p>在开发iOS大项目的时候,由于模块太多,每个功能的模块也太多,在后续测试调试的时候,遇见了bug,就会花比较长的时间去定位bug所在的类或者所在的函数.如果使用了单元测试便可以缩小查找bug的范围.</p>
<p>XCode自带单元测试的命令行工具,可以编写UnitTest文件来自动测试工程,下面来介绍一下它的一些些用法.</p>
<h3 id="首先得确定有xcodebuild命令-跳过-都是iOS开发者-肯定装了XCode咯"><a href="#首先得确定有xcodebuild命令-跳过-都是iOS开发者-肯定装了XCode咯" class="headerlink" title="首先得确定有xcodebuild命令(跳过,都是iOS开发者,肯定装了XCode咯)"></a>首先得确定有xcodebuild命令(跳过,都是iOS开发者,肯定装了XCode咯)</h3><pre><code>$xcodebuild
</code></pre><p>肯定没这么简单,假设当前目录是有XCode的工程的,那么这个命令就会执行与在xcode里面点击build一样的效果.</p>
<h3 id="使用xcodebuild运行测试"><a href="#使用xcodebuild运行测试" class="headerlink" title="使用xcodebuild运行测试"></a>使用xcodebuild运行测试</h3><p>xcodebuild 命令就是执行了 XCode 里面的build,不过这个命令有一些其他的参数,用法太多这儿就不解释了.总之给他加点儿不同的参数就可以做不同的事情.使用 test 来测试.用-scheme指定操作的scheme.用 -destination 指定target.要在本地 iPhone 5模拟机 “iPhone 5” 测试<code>某个工程</code>的某个<code>测试</code>,使用如下命令来指定目标和架构：</p>
<pre><code>xcodebuild test -project rct6updater.xcodeproj -scheme rct6updaterTest -destination &apos;platform=iOS ,name=iPhone 5&apos;
</code></pre><p>如果想对真机操作,可以按照名称或id.比如,我的测试机叫做”VikingWarlock 5”,可以这样来测试代码：</p>
<pre><code>xcodebuild test -workspace xuanwheel/xuanwheel.xcworkspace -scheme xuanwheelTests -destination &apos;platform=iOS,name=VikingWarlock 5&apos;
</code></pre><p>测试也可以在 iOS模拟器上运行.使用模拟器可以应对不同的外形因素和操作系统版本.例如：</p>
<pre><code>xcodebuild test -workspace xuanwheel/xuanwheel.xcworkspace -scheme xuanwheelTests -destination &apos;platform=iOS Simulator,name=iPhone,0S=7.0&apos; -destination 
</code></pre><p>如果测试失败,xcodebuild 会有红色的 FAIL 提示,修改修改测试的代码,多加一些提醒,这样可以更方便的定位错误点.</p>
<h3 id="等下"><a href="#等下" class="headerlink" title="等下"></a>等下</h3><p>之前是-project的,怎么突然使用了-workspace嘞?因为我的工程使用cocoaPods了,所以测试的时候要使用workspace才行.</p>

      
    </div>
    
  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/hexosource/categories/programming/">编程</a>
    </span>
    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/hexosource/tags/ios/">iOS</a>
    </span>
    

    </div>

    
  </div>
  
    
    <h3 class="article-read"><a href="/hexosource/programming/20160601-ios-unit-test.html"><span>点击阅读</span></a></h3>
    
  
</article>





  <article class="article-container ">

  
    
    <h3 class="article-title"><a href="/hexosource/programming/20160528-sublime-develop-arduino.html"><span>Sublime 开发arduino</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/hexosource/programming/20160528-sublime-develop-arduino.html" rel="bookmark">
        <time class="entry-date published" datetime="2016-05-28T15:36:34.000Z">
          2016-05-28
        </time>
      </a>
    </span>
    <br />
    
  </div>


  

  <div class="article-content">
    <div class="entry">
      
          <h3 id="把Sublime改装成arduino的IDE"><a href="#把Sublime改装成arduino的IDE" class="headerlink" title="把Sublime改装成arduino的IDE"></a>把Sublime改装成arduino的IDE</h3><p>参加一个物联网比赛,它要求使用的开发板是基于Arduino的.可是,Arduino自己做的IDE简直难过死了,没有自动不全,也不能输入中文所以我想了一下,强大的sublime一定是有arduino的插件的！</p>
<h3 id="安装Sublime"><a href="#安装Sublime" class="headerlink" title="安装Sublime"></a>安装Sublime</h3><p>Sublime很牛逼,三个平台都有,百度上面一搜,去官网下载就好了,安装也不麻烦,所以就不说了</p>
<h3 id="安装package-control"><a href="#安装package-control" class="headerlink" title="安装package-control"></a>安装package-control</h3><p>Sublime 有两个发行版Sublime Text 2 和 Sublime Text 3<br>针对这两个不同的版本方法也是不一样的</p>
<ol>
<li>Ctrl(Command) + <code>~</code> 呼出命令行</li>
<li>直接把下面的代码往里面怼,然后按Enter(Return)</li>
<li>等</li>
</ol>
<p>Sublime Text 2 的安装方法:</p>
<pre><code>import urllib2,os; pf=&apos;Package Control.sublime-package&apos;; ipp =sublime.installed_packages_path(); os.makedirs( ipp ) if not os.path.exists(ipp) else None; urllib2.install_opener( urllib2.build_opener(urllib2.ProxyHandler( ))); open( os.path.join( ipp, pf),&apos;wb&apos; ).write( urllib2.urlopen(&apos;http://sublime.wbond.net/&apos; +pf.replace( &apos;&apos;,&apos;%20&apos; )).read()); print( &apos;Please restart Sublime Text to finish installation&apos;)
</code></pre><p>Sublime Text 3 的安装方法:</p>
<pre><code>import urllib.request,os; pf = &apos;Package Control.sublime-package&apos;; ipp=sublime.installed_packages_path();urllib.request.install_opener(urllib.request.build_opener(urllib.request.ProxyHandler()) ); open(os.path.join(ipp, pf),&apos;wb&apos;).write(urllib.request.urlopen( &apos;http://sublime.wbond.net/&apos; +pf.replace(&apos; &apos;,&apos;%20&apos;)).read())
</code></pre><p>原来都是python语句(我总觉得sublime text的作者一定钟爱python)</p>
<h3 id="安装stino"><a href="#安装stino" class="headerlink" title="安装stino"></a>安装stino</h3><ol>
<li>Crtl+Shift+P 打开另一种命令行</li>
<li>输入<code>Package Control: Add Repository</code>,按个Enter(Return)</li>
<li>输入Stino的开源地址 <code>https://github.com/gepd/Stino/tree/new-stino</code>,按个Enter(Return)</li>
<li>Ctrl+Shift+P 再一遍,输入<code>Package Control: Install Package</code></li>
<li>等他更新完所有的源之后,输入stino,安装就好啦</li>
</ol>
<h3 id="后续"><a href="#后续" class="headerlink" title="后续"></a>后续</h3><p>这个stino是可以代替arduino来进行交叉编译&amp;上传代码的,不过这个功能必须要求Arduino IDE在当前平台也支持编译和上传某种板子(比赛用的板子就不支持Linux下的Arduino…)</p>
<p>stino安装完毕之后是需要选择Arduino IDE的安装位置,据说不要使用最新的Arduino,因为stino好像是不支持的.</p>
<h3 id="小秘密"><a href="#小秘密" class="headerlink" title="小秘密"></a>小秘密</h3><p>我感觉stino除了加了自动补全,以及一些基本arduino的语法补全之外,并没有什么特点.假设工程中需要调用其他的文件,其他的库,还是用的不爽……</p>

      
    </div>
    
  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/hexosource/categories/programming/">编程</a>
    </span>
    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/hexosource/tags/ide/">IDE</a>
    </span>
    

    </div>

    
  </div>
  
    
    <h3 class="article-read"><a href="/hexosource/programming/20160528-sublime-develop-arduino.html"><span>点击阅读</span></a></h3>
    
  
</article>






<nav class="pagination">
  
  <a href="/hexosource/page/6/" class="pagination-prev">上一页</a>
  
  
  <a href="/hexosource/page/8/" class="pagination-next">下一页</a>
  
</nav>
            </main>
            <div class="sidebar
                    col-lg-3 col-lg-offset-0
                    col-md-3 col-md-offset-0
                    col-sm-12
                    col-xs-12
                    sidebar-container
                ">

                <div class="sidebar-container">



<div class="search-container">
<form class="site-search-form">
    <span class="glyphicon glyphicon-search"></span><input type="text" id="local-search-input" class="st-search-input" placeholder="Search..." />
</form>
<div id="local-search-result" class="local-search-result-cls"></div>
</div>
<script type="text/javascript" id="local.search.active">
var inputArea       = document.querySelector("#local-search-input");
inputArea.onclick   = function(){ getSearchFile(); this.onclick = null }
inputArea.onkeydown = function(){ if(event.keyCode == 13) return false }
</script>




    <div class="categories-container" style="margin-top:40px;">
        <p>归档:</p>
            
                <a href="/hexosource/categories/book/" title="书记" rel="3">书记</a>
            
                <a href="/hexosource/categories/wtf/" title="什么鬼" rel="4">什么鬼</a>
            
                <a href="/hexosource/categories/study/" title="学习" rel="10">学习</a>
            
                <a href="/hexosource/categories/life/" title="日记" rel="24">日记</a>
            
                <a href="/hexosource/categories/programming/" title="编程" rel="41">编程</a>
            
                <a href="/hexosource/categories/hack/" title="黑科技" rel="1">黑科技</a>
            
    </div>




    <div class="social-container" style="margin-top:40px;">
        <p>Links:</p>
            
                
                    <li class="social-item"><i class="fa fa-fw fa-github"></i><a target="_blank" rel="noopener" href="https://github.com/Boseny">GitHub</a></li>
                
            
                
                    <li class="social-item"><i class="fa fa-fw fa-weibo"></i><a target="_blank" rel="noopener" href="https://weibo.com/boseny">微博</a></li>
                
            
                
                    <li class="social-item"><i class=" fa fa-fw zhihu-icon"></i><a target="_blank" rel="noopener" href="https://www.zhihu.com/people/boseny">知乎</a></li>
                
            
                
                    <li class="social-item"><i class=" fa fa-fw lofter-icon"></i><a target="_blank" rel="noopener" href="http://boseny.lofter.com/">Lofter</a></li>
                
            
    </div>

</div>
            </div>
          </div>
        </div>
        
    <footer class="site-footer">
  <p class="site-info">
    Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and
    Theme by <a href="https://github.com/BosenY/Lap" target="_blank">Lap</a>
    <br/><span id="busuanzi_container_site_uv"> 
  本站访客数<span id="busuanzi_value_site_uv"></span>人次
</span>
    </br>
    
      
        &copy; 2023 Viking Warlock
      
    
  </p>
</footer>
    
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-92842840-1', 'auto');
    ga('send', 'pageview');

</script>


  </div>

</div>
<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<script src="https://cdn.bootcss.com/vue/2.5.13/vue.min.js"></script>
<script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
<script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

  <script src="https://unpkg.com/draw-something/dist/draw.min.js"></script>
  <script>
    let maxNum = Number.parseInt('10')
    let iconText = '❤'
    let color = 'red'
    new Draw({maxNum, iconText, color})
  </script>

<script src="/hexosource/js/index.js"></script>
<script src="/hexosource/js/search.js"></script>

</body>
</html>